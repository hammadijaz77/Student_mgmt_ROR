import r from"graceful-fs";import e from"path";import t from"util";import n from"lazystream";import a from"normalize-path";import i from"lodash.defaults";import f from"stream";import o from"readable-stream";import c from"lodash.flatten";import s from"lodash.difference";import u from"lodash.union";import l from"lodash.isplainobject";import p from"glob";import v from"buffer";var m={};var d=r;var h=e;var g=c;var y=s;var w=u;var x=l;var b=p;var j=m={};var S=/[\/\\]/g;var processPatterns=function(r,e){var t=[];g(r).forEach((function(r){var n=0===r.indexOf("!");n&&(r=r.slice(1));var a=e(r);t=n?y(t,a):w(t,a)}));return t};j.exists=function(){var r=h.join.apply(h,arguments);return d.existsSync(r)};j.expand=function(...r){var e=x(r[0])?r.shift():{};var t=Array.isArray(r[0])?r[0]:r;if(0===t.length)return[];var n=processPatterns(t,(function(r){return b.sync(r,e)}));e.filter&&(n=n.filter((function(r){r=h.join(e.cwd||"",r);try{return"function"===typeof e.filter?e.filter(r):d.statSync(r)[e.filter]()}catch(r){return false}})));return n};j.expandMapping=function(r,e,t){t=Object.assign({rename:function(r,e){return h.join(r||"",e)}},t);var n=[];var a={};j.expand(t,r).forEach((function(r){var i=r;t.flatten&&(i=h.basename(i));t.ext&&(i=i.replace(/(\.[^\/]*)?$/,t.ext));var f=t.rename(e,i,t);t.cwd&&(r=h.join(t.cwd,r));f=f.replace(S,"/");r=r.replace(S,"/");if(a[f])a[f].src.push(r);else{n.push({src:[r],dest:f});a[f]=n[n.length-1]}}));return n};j.normalizeFilesArray=function(r){var e=[];r.forEach((function(r){var t;("src"in r||"dest"in r)&&e.push(r)}));if(0===e.length)return[];e=_(e).chain().forEach((function(r){"src"in r&&r.src&&(Array.isArray(r.src)?r.src=g(r.src):r.src=[r.src])})).map((function(r){var e=Object.assign({},r);delete e.src;delete e.dest;if(r.expand)return j.expandMapping(r.src,r.dest,e).map((function(e){var t=Object.assign({},r);t.orig=Object.assign({},r);t.src=e.src;t.dest=e.dest;["expand","cwd","flatten","rename","ext"].forEach((function(r){delete t[r]}));return t}));var t=Object.assign({},r);t.orig=Object.assign({},r);"src"in t&&Object.defineProperty(t,"src",{enumerable:true,get:function fn(){var t;if(!("result"in fn)){t=r.src;t=Array.isArray(t)?g(t):[t];fn.result=j.expand(e,t)}return fn.result}});"dest"in t&&(t.dest=r.dest);return t})).flatten().value();return e};var E=m;var O={};var A=v.Buffer;var z=r;var P=e;var D=t;var R=n;var k=a;var I=i;var M=f.Stream;var T=o.PassThrough;var B=O={};B.file=E;function assertPath(r){if("string"!==typeof r)throw new TypeError("Path must be a string. Received "+nutils.inspect(r))}B.collectStream=function(r,e){var t=[];var n=0;r.on("error",e);r.on("data",(function(r){t.push(r);n+=r.length}));r.on("end",(function(){var r=new A(n);var a=0;t.forEach((function(e){e.copy(r,a);a+=e.length}));e(null,r)}))};B.dateify=function(r){r=r||new Date;r=r instanceof Date?r:"string"===typeof r?new Date(r):new Date;return r};B.defaults=function(r,e,t){var n=arguments;n[0]=n[0]||{};return I(...n)};B.isStream=function(r){return r instanceof M};B.lazyReadStream=function(r){return new R.Readable((function(){return z.createReadStream(r)}))};B.normalizeInputSource=function(r){if(null===r)return new A(0);if("string"===typeof r)return new A(r);if(B.isStream(r)&&!r._readableState){var e=new T;r.pipe(e);return e}return r};B.sanitizePath=function(r){return k(r,false).replace(/^\w+:/,"").replace(/^(\.\.\/|\/)+/,"")};B.trailingSlashIt=function(r){return"/"!==r.slice(-1)?r+"/":r};B.unixifyPath=function(r){return k(r,false).replace(/^\w+:/,"")};B.walkdir=function(r,e,t){var n=[];if("function"===typeof e){t=e;e=r}z.readdir(r,(function(a,i){var f=0;var o;var c;if(a)return t(a);(function next(){o=i[f++];if(!o)return t(null,n);c=P.join(r,o);z.stat(c,(function(r,t){n.push({path:c,relative:P.relative(e,c).replace(/\\/g,"/"),stats:t});t&&t.isDirectory()?B.walkdir(c,e,(function(r,e){e.forEach((function(r){n.push(r)}));next()})):next()}))})()}))};var F=O;export default F;

