import e from"readable-stream";import t from"inherits";import r from"process";var i="undefined"!==typeof globalThis?globalThis:"undefined"!==typeof self?self:global;var s={};var n=r;var a=e.Duplex;var o=e.PassThrough;var p=e.Readable;var l=t;var h=("undefined"!==typeof n.nextTick,n.nextTick);s=Pipeline;l(Pipeline,a);s.obj=function(e,t){if(!t&&!Array.isArray(e)){t=e;e=[]}e||(e=[]);t||(t={});t.objectMode=true;return new Pipeline(e,t)};function Pipeline(e,t){if(!((this||i)instanceof Pipeline))return new Pipeline(e,t);if(!t&&!Array.isArray(e)){t=e;e=[]}e||(e=[]);t||(t={});a.call(this||i,t);var r=this||i;(this||i)._options=t;(this||i)._wrapOptions={objectMode:false!==t.objectMode};(this||i)._streams=[];(this||i).splice.apply(this||i,[0,0].concat(e));this.once("finish",(function(){r._notEmpty();r._streams[0].end()}))}Pipeline.prototype._read=function(){var e=this||i;this._notEmpty();var t=(this||i)._streams[(this||i)._streams.length-1];var r,s=0;while(null!==(r=t.read())){a.prototype.push.call(this||i,r);s++}if(0===s){var onreadable=function(){t.removeListener("readable",onreadable);e.removeListener("_mutate",onreadable);e._read()};t.once("readable",onreadable);e.once("_mutate",onreadable)}};Pipeline.prototype._write=function(e,t,r){this._notEmpty();(this||i)._streams[0]._write(e,t,r)};Pipeline.prototype._notEmpty=function(){var e=this||i;if(!((this||i)._streams.length>0)){var t=new o((this||i)._options);t.once("end",(function(){var r=e._streams.indexOf(t);r>=0&&r===e._streams.length-1&&a.prototype.push.call(e,null)}));(this||i)._streams.push(t);(this||i).length=(this||i)._streams.length}};Pipeline.prototype.push=function(e){var t=[(this||i)._streams.length,0].concat([].slice.call(arguments));(this||i).splice.apply(this||i,t);return(this||i)._streams.length};Pipeline.prototype.pop=function(){return this.splice((this||i)._streams.length-1,1)[0]};Pipeline.prototype.shift=function(){return this.splice(0,1)[0]};Pipeline.prototype.unshift=function(){(this||i).splice.apply(this||i,[0,0].concat([].slice.call(arguments)));return(this||i)._streams.length};Pipeline.prototype.splice=function(e,t){var r=this||i;var s=(this||i)._streams.length;e=e<0?s-e:e;void 0===t&&(t=s-e);t=Math.max(0,Math.min(s-e,t));for(var n=e;n<e+t;n++)r._streams[n-1]&&r._streams[n-1].unpipe(r._streams[n]);r._streams[n-1]&&r._streams[n]&&r._streams[n-1].unpipe(r._streams[n]);var o=n;var p=[],l=arguments;for(var h=2;h<l.length;h++)(function(e){Array.isArray(e)&&(e=new Pipeline(e,r._options));e.on("error",(function(e){e.stream=this||i;r.emit("error",e)}));e=r._wrapStream(e);e.once("end",(function(){var t=r._streams.indexOf(e);t>=0&&t===r._streams.length-1&&a.prototype.push.call(r,null)}));p.push(e)})(arguments[h]);for(var n=0;n<p.length-1;n++)p[n].pipe(p[n+1]);p.length&&r._streams[o]&&p[p.length-1].pipe(r._streams[o]);p[0]&&r._streams[e-1]&&r._streams[e-1].pipe(p[0]);var c=[e,t].concat(p);var m=r._streams.splice.apply(r._streams,c);for(var n=0;n<p.length;n++)p[n].read(0);this.emit("_mutate");(this||i).length=(this||i)._streams.length;return m};Pipeline.prototype.get=function(){if(0!==arguments.length){var e=this||i;for(var t=0;t<arguments.length;t++){var r=arguments[t];e=r<0?e._streams[e._streams.length+r]:e._streams[r];if(!e)return}return e}};Pipeline.prototype.indexOf=function(e){return(this||i)._streams.indexOf(e)};Pipeline.prototype._wrapStream=function(e){if("function"===typeof e.read)return e;var t=new p((this||i)._wrapOptions).wrap(e);t._write=function(t,r,i){false===e.write(t)?e.once("drain",i):h(i)};return t};var c=s;const m=s.obj;export default c;export{m as obj};

