import e from"xtend";import r from"acorn-node";import t from"dash-ast";import n from"get-assigned-identifiers";var a={};var i=e;var o=r;var p=t;var c=n;function visitFunction(e,r,t){if(e.params.length>0){var n=[];for(var a=0;a<e.params.length;a++){var i=c(e.params[a]);for(var o=0;o<i.length;o++)n.push(i[o])}declareNames(e,n)}if("FunctionDeclaration"===e.type){var p=getScopeNode(t,"const");declareNames(p,[e.id])}else"FunctionExpression"===e.type&&e.id&&declareNames(e,[e.id])}var s={VariableDeclaration:function(e,r,t){var n=getScopeNode(t,e.kind);for(var a=0;a<e.declarations.length;a++)declareNames(n,c(e.declarations[a].id))},FunctionExpression:visitFunction,FunctionDeclaration:visitFunction,ArrowFunctionExpression:visitFunction,ClassDeclaration:function(e,r,t){var n=getScopeNode(t,"const");e.id&&declareNames(n,[e.id])},ImportDeclaration:function(e,r,t){declareNames(t[0],c(e))},CatchClause:function(e){e.param&&declareNames(e,[e.param])}};var d={Identifier:function(e,r,t){if(r.identifiers){var n=t[t.length-1];if(("MemberExpression"!==n.type||n.property!==e)&&("Property"!==n.type||n.computed||n.key!==e)&&("MethodDefinition"!==n.type||n.computed||n.key!==e)&&("LabeledStatement"!==n.type||n.label!==e)){if(!has(r.undeclared,e.name)){for(var a=t.length-1;a>=0;a--)if(void 0!==t[a]._names&&has(t[a]._names,e.name))return;r.undeclared[e.name]=true}!r.wildcard||"MemberExpression"===n.type&&n.object===e||"VariableDeclarator"===n.type&&n.id===e||"AssignmentExpression"===n.type&&n.left===e||(r.undeclaredProps[e.name+".*"]=true)}}},MemberExpression:function(e,r){if(r.properties&&"Identifier"===e.object.type&&has(r.undeclared,e.object.name)){var t=e.computed||"Identifier"!==e.property.type?e.computed&&"Literal"===e.property.type?e.property.value:null:e.property.name;t&&(r.undeclaredProps[e.object.name+"."+t]=true)}}};a=function findUndeclared(e,r){r=i({identifiers:true,properties:true,wildcard:false},r);var t={undeclared:{},undeclaredProps:{},identifiers:r.identifiers,properties:r.properties,wildcard:r.wildcard};var n="object"===typeof e&&null!==e&&"string"===typeof e.type?e:o.parse(e);var a=[];p(n,{enter:function(e,r){r&&a.push(r);var n=s[e.type];n&&n(e,t,a)},leave:function(e,r){var n=d[e.type];n&&n(e,t,a);r&&a.pop()}});return{identifiers:Object.keys(t.undeclared),properties:Object.keys(t.undeclaredProps)}};function getScopeNode(e,r){for(var t=e.length-1;t>=0;t--){if("FunctionDeclaration"===e[t].type||"FunctionExpression"===e[t].type||"ArrowFunctionExpression"===e[t].type||"Program"===e[t].type)return e[t];if("var"!==r&&"BlockStatement"===e[t].type)return e[t]}}function declareNames(e,r){void 0===e._names&&(e._names=Object.create(null));for(var t=0;t<r.length;t++)e._names[r[t].name]=true}function has(e,r){return Object.prototype.hasOwnProperty.call(e,r)}var l=a;export default l;

