import e from"./is.js";import"./has.js";import r from"./def.js";import"./promise.js";import"./flatten.js";import t from"./emitterify.js";var i={};var n={add:add,update:update,remove:remove},o=t,a=r,l=e,f=JSON.stringify,u=JSON.parse;i=function set(e,r){return function(t,i,n){if(!l.obj(t)&&!l.fn(t))return t;if(!l.obj(e)){var p=i||t.log||[],m=t;l.def(n)||(n=p.max||0);n||(p=[]);n<0&&(p=p.concat(null));if(n>0){var s=f(t);m=u(s);p=p.concat({type:"update",value:u(s),time:p.length})}a(p,"max",n);m.log?m.log=p:a(o(m,null),"log",p,1);return m}if(!l.def(e.key))return false;if(!apply(t,e.type,(e.key=""+e.key).split(".").filter(Boolean),e.value))return false;t.log&&t.log.max&&t.log.push((e.time=t.log.length,t.log.max>0?e:null));!r&&t.emit&&t.emit("change",e);return t}};function apply(e,r,t,i){var o=t.shift();if(!n[r])return false;if(t.length){if(!(o in e)){if("remove"==r)return true;e[o]={}}return apply(e[o],r,t,i)}return!n[r](e,o,i)}function add(e,r,t){l.arr(e)?e.splice(r,0,t):e[r]=t}function update(e,r,t){if(l.num(r)||r)e[r]=t;else{if(!l.obj(t))return true;for(var i in e)delete e[i];for(var i in t)e[i]=t[i]}}function remove(e,r,t){l.arr(e)?e.splice(r,1):delete e[r]}var p=i;export default p;

