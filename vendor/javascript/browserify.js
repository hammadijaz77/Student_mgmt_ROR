import e from"module-deps";import r from"deps-sort";import t from"browser-pack";import i from"insert-module-globals";import n from"syntax-error";import o from"./lib/builtins.js";import s from"labeled-stream-splicer";import a from"through2";import f from"concat-stream";import u from"inherits";import l from"events";import p from"xtend";import d from"isarray";import c from"defined";import h from"has";import m from"htmlescape";import _ from"shasum";import b from"browser-resolve";import y from"resolve";import v from"read-only-stream";import x from"fs";import g from"path";import w from"process";var O="undefined"!==typeof globalThis?globalThis:"undefined"!==typeof self?self:global;var j={};function _nullRequire(e){var r=new Error("Cannot find module '"+e+"'");r.code="MODULE_NOT_FOUND";throw r}var B=w;var E=e;var k=r;var T=t;var P=i;var D=n;var q=o;var A=s;var S=a;var F=f;var I=u;var M=l.EventEmitter;var C=p;var N=d;var R=c;var G=h;var U=m.sanitize;var J=_;var L=b;var z=y;var K=v;j=Browserify;I(Browserify,M);var V=x;var $=g;var H={empty:$.join(new URL(import.meta.url.slice(0,import.meta.url.lastIndexOf("/"))).pathname,"lib/_empty.js")};function Browserify(e,r){var t=this||O;if(!((this||O)instanceof Browserify))return new Browserify(e,r);r||(r={});r="string"===typeof e||N(e)||isStream(e)?C(r,{entries:[].concat(r.entries||[],e)}):C(e,r);t._options=r;r.noparse&&(r.noParse=r.noparse);if(void 0!==r.basedir&&"string"!==typeof r.basedir)throw new Error("opts.basedir must be either undefined or a string.");t._external=[];t._exclude=[];t._ignore=[];t._expose={};t._hashes={};t._pending=0;t._transformOrder=0;t._transformPending=0;t._transforms=[];t._entryOrder=0;t._ticked=false;t._bresolve=false===r.browserField?function(e,r,t){r.basedir||(r.basedir=$.dirname(r.filename));z(e,r,t)}:L;t._syntaxCache={};var i=[].concat(r.ignoreTransform).filter(Boolean);t._filterTransform=function(e){return Array.isArray(e)?-1===i.indexOf(e[0]):-1===i.indexOf(e)};t.pipeline=t._createPipeline(r);[].concat(r.transform).filter(Boolean).filter(t._filterTransform).forEach((function(e){t.transform(e)}));[].concat(r.entries).filter(Boolean).forEach((function(e){t.add(e,{basedir:r.basedir})}));[].concat(r.require).filter(Boolean).forEach((function(e){t.require(e,{basedir:r.basedir})}));[].concat(r.plugin).filter(Boolean).forEach((function(e){t.plugin(e,{basedir:r.basedir})}))}Browserify.prototype.require=function(e,r){var t=this||O;if(N(e)){e.forEach((function(e){"object"===typeof e?t.require(e.file,C(r,e)):t.require(e,r)}));return this||O}r||(r={});var i=R(r.basedir,t._options.basedir,B.cwd());var n=r.expose;if(e===n&&/^[\.]/.test(n)){n="/"+$.relative(i,n);n=n.replace(/\\/g,"/")}void 0===n&&(this||O)._options.exposeAll&&(n=true);if(true===n){n="/"+$.relative(i,e);n=n.replace(/\\/g,"/")}if(isStream(e)){t._pending++;var o=t._entryOrder++;e.pipe(F((function(s){var a=r.file||e.file||$.join(i,"_stream_"+o+".js");var f=e.id||n||a;(n||false===r.entry)&&(t._expose[f]=a);r.entry||void 0!==t._options.exports||(t._bpack.hasExports=true);var u={source:s.toString("utf8"),entry:R(r.entry,false),file:a,id:f};u.entry&&(u.order=o);false===u.transform&&(u.transform=false);t.pipeline.write(u);0===--t._pending&&t.emit("_ready")})));return this||O}var s;s="object"===typeof e?C(e,r):!r.entry&&isExternalModule(e)?C(r,{id:n||e,file:e}):C(r,{file:$.resolve(i,e)});s.id||(s.id=n||s.file);!n&&s.entry||(s.expose=s.id);if(r.external)return t.external(e,r);void 0===s.entry&&(s.entry=false);s.entry||void 0!==t._options.exports||(t._bpack.hasExports=true);s.entry&&(s.order=t._entryOrder++);false===r.transform&&(s.transform=false);t.pipeline.write(s);return t};Browserify.prototype.add=function(e,r){var t=this||O;r||(r={});if(N(e)){e.forEach((function(e){t.add(e,r)}));return this||O}return this.require(e,C({entry:true,expose:false},r))};Browserify.prototype.external=function(e,r){var t=this||O;if(N(e)){e.forEach((function(e){"object"===typeof e?t.external(e,C(r,e)):t.external(e,r)}));return this||O}if(e&&"object"===typeof e&&"function"===typeof e.bundle){var i=e;t._pending++;var n={};var o={};i.on("label",(function(e,r){t._external.push(r);if(e!==r){o[e]=r;t._external.push(e)}}));i.pipeline.get("deps").push(S.obj((function(e,r,t){n=C(n,e.deps);this.push(e);t()})));t.on("dep",(function(e){Object.keys(e.deps).forEach((function(r){var t=n[r];if(t){var i=o[t];i&&(e.indexDeps[r]=i)}}))}));i.pipeline.get("label").once("end",(function(){0===--t._pending&&t.emit("_ready")}));return this||O}r||(r={});var s=R(r.basedir,B.cwd());(this||O)._external.push(e);(this||O)._external.push("/"+$.relative(s,e));return this||O};Browserify.prototype.exclude=function(e,r){r||(r={});var t=R(r.basedir,B.cwd());(this||O)._exclude.push(e);(this||O)._exclude.push("/"+$.relative(t,e));return this||O};Browserify.prototype.ignore=function(e,r){r||(r={});var t=R(r.basedir,B.cwd());"."===e[0]?(this||O)._ignore.push($.resolve(t,e)):(this||O)._ignore.push(e);return this||O};Browserify.prototype.transform=function(e,r){var t=this||O;"function"!==typeof r&&"string"!==typeof r||(e=[r,e]);if(N(e)){r=e[1];e=e[0]}if("string"===typeof e&&!t._filterTransform(e))return this||O;function resolved(){t._transforms[n]=o;--t._pending;if(0===--t._transformPending){t._transforms.forEach((function(e){t.pipeline.write(e)}));0===t._pending&&t.emit("_ready")}}r||(r={});r._flags="_flags"in r?r._flags:t._options;var i=R(r.basedir,(this||O)._options.basedir,B.cwd());var n=t._transformOrder++;t._pending++;t._transformPending++;var o={transform:e,options:r,global:r.global};if("string"===typeof e){var s={basedir:i,paths:(t._options.paths||[]).map((function(e){return $.resolve(i,e)}))};z(e,s,(function(e,r){if(e)return t.emit("error",e);o.transform=r;resolved()}))}else B.nextTick(resolved);return this||O};Browserify.prototype.plugin=function(e,r){if(N(e)){r=e[1];e=e[0]}r||(r={});var t=R(r.basedir,(this||O)._options.basedir,B.cwd());if("function"===typeof e)e(this||O,r);else{var i=z.sync(String(e),{basedir:t});var n=_nullRequire(i);if("function"!==typeof n)throw new Error("plugin "+e+" should export a function");n(this||O,r)}return this||O};Browserify.prototype._createPipeline=function(e){var r=this||O;e||(e={});(this||O)._mdeps=this._createDeps(e);(this||O)._mdeps.on("file",(function(e,t){i.emit("file",e,t);r.emit("file",e,t)}));(this||O)._mdeps.on("package",(function(e){i.emit("package",e);r.emit("package",e)}));(this||O)._mdeps.on("transform",(function(e,t){i.emit("transform",e,t);r.emit("transform",e,t)}));var t={index:!e.fullPaths&&!e.exposeAll,dedupe:true,expose:(this||O)._expose};(this||O)._bpack=T(C(e,{raw:true}));var i=A.obj(["record",[this._recorder()],"deps",[(this||O)._mdeps],"json",[this._json()],"unbom",[this._unbom()],"unshebang",[this._unshebang()],"syntax",[this._syntax()],"sort",[k(t)],"dedupe",[this._dedupe()],"label",[this._label(e)],"emit-deps",[this._emitDeps()],"debug",[this._debug(e)],"pack",[(this||O)._bpack],"wrap",[]]);if(e.exposeAll){var n=R(e.basedir,B.cwd());i.get("deps").push(S.obj((function(e,t,i){if(r._external.indexOf(e.id)>=0)return i();if(r._external.indexOf(e.file)>=0)return i();isAbsolutePath(e.id)&&(e.id="/"+$.relative(n,e.file));Object.keys(e.deps||{}).forEach((function(r){e.deps[r]="/"+$.relative(n,e.deps[r])}));this.push(e);i()})))}return i};Browserify.prototype._createDeps=function(e){var r=this||O;var t=C(e);var i=R(e.basedir,B.cwd());t.expose=(this||O)._expose;t.extensions=[".js",".json"].concat(t.extensions||[]);r._extensions=t.extensions;t.transform=[];t.transformKey=["browserify","transform"];t.postFilter=function(t,i,n){if(e.postFilter&&!e.postFilter(t,i,n))return false;if(r._external.indexOf(i)>=0)return false;if(r._exclude.indexOf(i)>=0)return false;n&&n.browserify&&n.browserify.transform&&(n.browserify.transform=[].concat(n.browserify.transform).filter(Boolean).filter(r._filterTransform));return true};t.filter=function(t){return!(e.filter&&!e.filter(t))&&(!(r._external.indexOf(t)>=0)&&(!(r._exclude.indexOf(t)>=0)&&(false!==e.bundleExternal||!isExternalModule(t))))};t.resolve=function(e,t,n){if(r._ignore.indexOf(e)>=0)return n(null,H.empty,{});r._bresolve(e,t,(function(e,t,o){if(t&&r._ignore.indexOf(t)>=0)return n(null,H.empty,{});if(t&&r._ignore.length){var s=t.split("/node_modules/")[1];if(s){s=s.split("/")[0];if(r._ignore.indexOf(s)>=0)return n(null,H.empty,{})}}if(t){var a="/"+$.relative(i,t);if(r._external.indexOf(a)>=0)return n(null,a);if(r._exclude.indexOf(a)>=0)return n(null,a);if(r._ignore.indexOf(a)>=0)return n(null,H.empty,{})}e?n(e,t,o):t?V.realpath(t,(function(e,r){n(e,r,o,t)})):n(e,null,o)}))};if(false===e.builtins){t.modules={};r._exclude.push.apply(r._exclude,Object.keys(q))}else if(e.builtins&&N(e.builtins)){t.modules={};e.builtins.forEach((function(e){t.modules[e]=q[e]}))}else e.builtins&&"object"===typeof e.builtins?t.modules=e.builtins:t.modules=C(q);Object.keys(q).forEach((function(e){G(t.modules,e)||r._exclude.push(e)}));t.globalTransform=[];(this||O)._bundled||this.once("bundle",(function(){r.pipeline.write({transform:globalTr,global:true,options:{}})}));var n=[].concat(e.noParse).filter(Boolean);var o=n.filter((function(e){return"string"===typeof e})).map((function(e){return $.resolve(i,e)}));function globalTr(r){if(false===e.detectGlobals)return S();if(true===e.noParse)return S();if(n.indexOf(r)>=0)return S();if(o.indexOf(r)>=0)return S();var t=r.split("/node_modules/");for(var i=0;i<n.length;i++){if("function"===typeof n[i]&&n[i](r))return S();if(n[i]===t[t.length-1].split("/")[0])return S();if(n[i]===t[t.length-1])return S()}var s=C({process:function(){return"require('_process')"}},e.insertGlobalVars);if(false===e.bundleExternal){s.process=void 0;s.buffer=void 0}return P(r,C(e,{debug:e.debug,always:e.insertGlobals,basedir:false===e.commondir?"/":e.basedir||B.cwd(),vars:s}))}return E(t)};Browserify.prototype._recorder=function(e){var r=this||O;var t=false;(this||O)._recorded=[];(this||O)._ticked||B.nextTick((function(){r._ticked=true;r._recorded.forEach((function(e){i.push(e)}));t&&i.push(null)}));var i=S.obj(write,end);return i;function write(e,t,i){r._recorded.push(e);r._ticked&&this.push(e);i()}function end(){t=true;r._ticked&&this.push(null)}};Browserify.prototype._json=function(){return S.obj((function(e,r,t){/\.json$/.test(e.file)&&(e.source="module.exports="+U(e.source));this.push(e);t()}))};Browserify.prototype._unbom=function(){return S.obj((function(e,r,t){/^\ufeff/.test(e.source)&&(e.source=e.source.replace(/^\ufeff/,""));this.push(e);t()}))};Browserify.prototype._unshebang=function(){return S.obj((function(e,r,t){/^#!/.test(e.source)&&(e.source=e.source.replace(/^#![^\n]*\n/,""));this.push(e);t()}))};Browserify.prototype._syntax=function(){var e=this||O;return S.obj((function(r,t,i){var n=J(r.source);if("undefined"===typeof e._syntaxCache[n]){var o=D(r.source,r.file||r.id);if(o)return this.emit("error",o);e._syntaxCache[n]=true}this.push(r);i()}))};Browserify.prototype._dedupe=function(){return S.obj((function(e,r,t){if(!e.dedupeIndex&&e.dedupe){e.source="arguments[4]["+JSON.stringify(e.dedupe)+"][0].apply(exports,arguments)";e.nomap=true}else if(e.dedupeIndex){e.source="arguments[4]["+JSON.stringify(e.dedupeIndex)+"][0].apply(exports,arguments)";e.nomap=true}e.dedupeIndex&&e.indexDeps&&(e.indexDeps.dup=e.dedupeIndex);this.push(e);t()}))};Browserify.prototype._label=function(e){var r=this||O;var t=R(e.basedir,B.cwd());return S.obj((function(e,i,n){var o=e.id;if(r._external.indexOf(e.id)>=0)return n();if(r._external.indexOf("/"+$.relative(t,e.id))>=0)return n();if(r._external.indexOf(e.file)>=0)return n();e.index&&(e.id=e.index);r.emit("label",o,e.id);e.indexDeps&&(e.deps=e.indexDeps||{});Object.keys(e.deps).forEach((function(i){if(r._expose[i])e.deps[i]=i;else{var n=$.resolve($.dirname(e.file),i);var o="/"+$.relative(t,n);r._external.indexOf(o)>=0&&(e.deps[i]=o);r._external.indexOf(n)>=0&&(e.deps[i]=o);if(r._external.indexOf(i)>=0)e.deps[i]=i;else for(var s=0;s<r._extensions.length;s++){var a=r._extensions[s];if(r._external.indexOf(o+a)>=0){e.deps[i]=o+a;break}}}}));(e.entry||e.expose)&&(r._bpack.standaloneModule=e.id);this.push(e);n()}))};Browserify.prototype._emitDeps=function(){var e=this||O;return S.obj((function(r,t,i){e.emit("dep",r);this.push(r);i()}))};Browserify.prototype._debug=function(e){var r=R(e.basedir,B.cwd());return S.obj((function(t,i,n){if(e.debug){t.sourceRoot="file://localhost";t.sourceFile=$.relative(r,t.file).replace(/\\/g,"/")}this.push(t);n()}))};Browserify.prototype.reset=function(e){e||(e={});var r=(this||O)._bpack.hasExports;(this||O).pipeline=this._createPipeline(C(e,(this||O)._options));(this||O)._bpack.hasExports=r;(this||O)._entryOrder=0;(this||O)._bundled=false;this.emit("reset")};Browserify.prototype.bundle=function(e){var r=this||O;if(e&&"object"===typeof e)throw new Error("bundle() no longer accepts option arguments.\n"+"Move all option arguments to the browserify() constructor.");if((this||O)._bundled){var t=(this||O)._recorded;this.reset();t.forEach((function(e){r.pipeline.write(e)}))}var i=K((this||O).pipeline);if(e){i.on("error",e);i.pipe(F((function(r){e(null,r)})))}function ready(){r.emit("bundle",i);r.pipeline.end()}0===(this||O)._pending?ready():this.once("_ready",ready);(this||O)._bundled=true;return i};function isStream(e){return e&&"function"===typeof e.pipe}function isAbsolutePath(e){var r="win32"===B.platform?/^\w:/:/^\//;return r.test(e)}function isExternalModule(e){var r="win32"===B.platform?/^(\.|\w:)/:/^[\/.]/;return!r.test(e)}var Q=j;export default Q;

