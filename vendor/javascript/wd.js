import e from"url";import t from"events";import r from"lodash";import"util";import"http";import"https";import"vargs";import o from"./utils.js";import"request";import"../package.json.js";import"buffer";import"./http-utils.js";import{_ as n,a as i}from"../_/36dbddf9.js";import"fs";import"./callbacks.js";import"path";import"os";import s from"process";import"async";import"archiver";import a from"./element.js";import p from"./webdriver.js";import u from"q";var c={};var h={NULL:"",Cancel:"",Help:"","Back space":"",Tab:"",Clear:"",Return:"",Enter:"",Shift:"",Control:"",Alt:"",Pause:"",Escape:"",Space:"",Pageup:"",Pagedown:"",End:"",Home:"","Left arrow":"","Up arrow":"","Right arrow":"","Down arrow":"",Insert:"",Delete:"",Semicolon:"",Equals:"","Numpad 0":"","Numpad 1":"","Numpad 2":"","Numpad 3":"","Numpad 4":"","Numpad 5":"","Numpad 6":"","Numpad 7":"","Numpad 8":"","Numpad 9":"",Multiply:"",Add:"",Separator:"",Subtract:"",Decimal:"",Divide:"",F1:"",F2:"",F3:"",F4:"",F5:"",F6:"",F7:"",F8:"",F9:"",F10:"",F11:"",F12:"",Command:"",Meta:""};c=h;var l=c;var d="undefined"!==typeof globalThis?globalThis:"undefined"!==typeof self?self:global;var f={};var m=Array.prototype.slice,y=r,v=p,E=a;var TouchAction=function(e){(this||d).driver=e;(this||d).gestures=[]};TouchAction.prototype.addGesture=function(e,t){t=t||{};var r=t.element||t.el;if(r&&!(r instanceof E))throw new Error("Invalid element or el field passed");var o={};y(t).each((function(e,t){y.isNumber(e)?o[t]=e:e instanceof E?o[t]=e.value:e&&(o[t]=e)}));if(o.el){o.element=o.el;delete o.el}(this||d).gestures.push({action:e,options:o})};TouchAction.prototype.toJSON=function(){return(this||d).gestures};TouchAction.prototype.longPress=function(e){this.addGesture("longPress",e);return this||d};TouchAction.prototype.moveTo=function(e){this.addGesture("moveTo",e);return this||d};TouchAction.prototype.press=function(e){this.addGesture("press",e);return this||d};TouchAction.prototype.release=function(){this.addGesture("release",{});return this||d};TouchAction.prototype.tap=function(e){this.addGesture("tap",e);return this||d};TouchAction.prototype.wait=function(e){y.isNumber(e)&&(e={ms:e});this.addGesture("wait",e);return this||d};TouchAction.prototype.cancel=function(){(this||d).gestures=[]};TouchAction.prototype.perform=function(e){if("function"!==typeof e)return(this||d).driver.performTouchAction(this||d);(this||d).driver.performTouchAction(this||d,e)};var MultiAction=function(e){if(e instanceof E){(this||d).element=e;(this||d).browser=(this||d).element.browser}else e instanceof v&&((this||d).browser=e);(this||d).actions=[]};MultiAction.prototype.toJSON=function(){var e={};(this||d).element&&(e.elementId=(this||d).element.value);e.actions=y((this||d).actions).map((function(e){return e.toJSON()})).value();return e};MultiAction.prototype.add=function(){var e=m.call(arguments,0);(this||d).actions=(this||d).actions.concat(e);return this||d};MultiAction.prototype.cancel=function(){(this||d).actions=[]};MultiAction.prototype.perform=function(e){if("function"!==typeof e)return(this||d).element?(this||d).element.performMultiAction(this||d):(this||d).browser.performMultiAction(this||d);(this||d).element?(this||d).element.performMultiAction(this||d,e):(this||d).browser.performMultiAction(this||d,e)};var InputDevice=function(e){e=e||{};(this||d).type=e.type||"none";(this||d).id=e.id;if("pointer"===(this||d).type)if(e.pointerType){(this||d).parameters={};(this||d).parameters.pointerType=e.pointerType}else y.isObject(e.parameters)?(this||d).parameters=e.parameters:(this||d).parameters={pointerType:"touch"};(this||d).actions=[]};InputDevice.ACTION_TYPES={KEY:"key",POINTER:"pointer",NONE:"none"};InputDevice.KEYS={UNIDENTIFIED:"",CANCEL:"",HELP:"",BACKSPACCE:"",TAB:"",CLEAR:"",RETURN:"",ENTER:"",SHIFT:"",CONTROL:"",ALT:"",PAUSE:"",ESCAPE:"",WHITESPACE:"",PAGE_UP:"",PAGE_DOWN:"",END:"",HOME:"",ARROW_LEFT:"",ARROW_UP:"",ARROW_RIGHT:"",ARROW_DOWN:"",INSERT:"",DELETE:"",";":"","=":"",0:"",1:"",2:"",3:"",4:"",5:"",6:"",7:"",8:"",9:"","*":"","+":"",",":"","-":"",".":"","/":"",F1:"",F2:"",F3:"",F4:"",F5:"",F6:"",F7:"",F8:"",F9:"",F10:"",F11:"",F12:"",META:"",ZENKAKU_HANKAKU:""};InputDevice.prototype.addAction=function(e,t){var r={};y(t).each((function(e,t){y.isNumber(e)?r[t]=e:e instanceof E?r[t]=e.value:e&&(r[t]=e)}));(this||d).actions.push(Object.assign({type:e},r))};InputDevice.prototype.pause=function(e){var t=y.isNumber(e)?e:e.duration;this.addAction("pause",{duration:t})};InputDevice.prototype.keyDown=function(e){return this.keyPressEvent("keyDown",e)};InputDevice.prototype.keyUp=function(e){return this.keyPressEvent("keyUp",e)};InputDevice.prototype.keyPressEvent=function(e,t){t=t||{};y.isString(t)&&(t={value:t});this.addAction(e,t);return this||d};InputDevice.prototype.pointerDown=function(e){return this.pointerButtonAction("pointerDown",e)};InputDevice.prototype.pointerUp=function(e){return this.pointerButtonAction("pointerUp",e)};InputDevice.prototype.pointerButtonAction=function(e,t){t=t||{};y.isNumber(t)?t={button:t}:y.isNil(t.button)&&(t.button=0);this.addAction(e,t);return this||d};InputDevice.prototype.pointerCancel=function(e){this.addAction("pointerCancel",y.defaults(e,{button:0}));return this||d};
/**
 * pointerMove({el, duration, origin, x, y})
 * 
 * * 'origin' must be either viewport or pointer (default is 'viewport'). 
 * * If el is set, origin will be that element
 * * 'x, y' Are coordinates relative to the origin
 * * 'duration' is an optional time in ms that determines how long the movement takes (default 0)
 * 
 * @param {*} opts 
 */InputDevice.prototype.pointerMove=function(e){e=e||{};var t=e.el||e.element;if(t&&!(t instanceof E))throw new Error("Invalid element or el field passed");t instanceof E&&(e.origin={"element-6066-11e4-a52e-4f735466cecf":t.value});this.addAction("pointerMove",e)};InputDevice.prototype.toJSON=function(){return y.omitBy(this||d,y.isFunction)};var W3CActions=function(e){(this||d).driver=e;(this||d).touchCount=1;(this||d).inputs={}};W3CActions.prototype.addInputDevice=function(e){if(y.isNil(e.id)){if("pointer"===e.type){var t=e.parameters.pointerType;if("touch"===t){e.id="finger"+(this||d).touchCount;(this||d).touchCount++}else e.id="mouse"===t?"default mouse":t}else e.id="key"===e.type?"keyboard":e.type;(this||d).inputs[e.id]=new InputDevice(e)}return(this||d).inputs[e.id]};W3CActions.prototype.addTouchInput=function(){return this.addInputDevice({type:"pointer",parameters:{pointerType:"touch"}})};W3CActions.prototype.addMouseInput=function(){return this.addInputDevice({type:"pointer",parameters:{pointerType:"mouse"}})};W3CActions.prototype.addPenInput=function(){return this.addInputDevice({type:"pointer",parameters:{pointerType:"pen"}})};W3CActions.prototype.addKeyInput=function(){return this.addInputDevice({type:"key"})};W3CActions.prototype.perform=function(e){return"function"===typeof e?(this||d).driver.performW3CActions(this||d,e):(this||d).driver.performW3CActions(this||d)};W3CActions.prototype.toJSON=function(){var e=y.values((this||d).inputs,(function(e){e.toJSON()}));return{actions:e}};f={TouchAction:TouchAction,MultiAction:MultiAction,InputDevice:InputDevice,W3CActions:W3CActions};var A=f;var w="undefined"!==typeof globalThis?globalThis:"undefined"!==typeof self?self:global;var b={};var g=Array.prototype.slice,C=u,P=r,_=t.EventEmitter,M=Array.prototype.slice.call.bind(Array.prototype.slice),N=o;var T=["clear","click","doubleClick","doubleclick","flick","tap","sendKeys","submit","type","keys","moveTo","sleep","noop"];function filterPromisedMethods(e){return P(e).functionsIn().filter((function(e){return!e.match("^newElement$|^toJSON$|^toString$|^_")&&!_.prototype[e]})).value()}b=function(e,t,r){function wrap(e,t){return function(){var o=this||w;var n;var i=M(arguments);var s=C.defer();s.promise.then((function(){o.emit("promise",o,t,i,"finished")}));for(var a=i.length-1;a>=0&&void 0===i[a];a--)i.pop();if("function"===typeof i[i.length-1]){n=i.pop();s.promise.then((function(e){n(null,e)}),(function(e){n(e)}))}i.push(s.makeNodeResolver());o.emit("promise",o,t,i,"calling");e.apply(this||w,i);return r?this._enrich(s.promise):s.promise}}var PromiseElement=function(){var e=1<=arguments.length?g.call(arguments,0):[];return t.apply(this||w,e)};PromiseElement.prototype=Object.create(t.prototype);PromiseElement.prototype.isPromised=true;var PromiseWebdriver=function(){var t=1<=arguments.length?g.call(arguments,0):[];return e.apply(this||w,t)};PromiseWebdriver.prototype=Object.create(e.prototype);PromiseWebdriver.prototype.isPromised=true;PromiseWebdriver.prototype.defaultChainingScope="browser";PromiseWebdriver.prototype.getDefaultChainingScope=function(){return(this||w).defaultChainingScope};P(filterPromisedMethods(e.prototype)).each((function(t){PromiseWebdriver.prototype[t]=wrap(e.prototype[t],t)}));P(filterPromisedMethods(t.prototype)).each((function(e){PromiseElement.prototype[e]=wrap(t.prototype[e],e)}));PromiseWebdriver.prototype.newElement=function(e){return new PromiseElement(e,this||w)};PromiseWebdriver.prototype._enrich=function(e,r){var o=this||w;if(N.isPromise(e)&&!e.__wd_promise_enriched){var n=e;n.__wd_promise_enriched=true;P(n).functionsIn().filter((function(e){return"promiseDispatch"!==e})).each((function(e){var t=n[e];n[e]=function(){var e=t.apply(this||w,g.call(arguments,0));return this._enrich(e,r)}}));var i=filterPromisedMethods(Object.getPrototypeOf(o));o.sampleElement=o.sampleElement||o.newElement(1);var s=filterPromisedMethods(Object.getPrototypeOf(o.sampleElement));var a=P.union(i,s);P(a).each((function(e){n[e]=function(){var n=g.call(arguments,0);var a;if(n&&n[0]&&"string"===typeof n[0]&&n[0].match(/^[<>]$/)){a=n[0];n=P.drop(n)}return this.then((function(p){var u;t&&p instanceof t&&(u=p);u=u||r;var c=P.indexOf(i,e)>=0;var h=u&&P.indexOf(s,e)>=0;if(!c&&!h)throw new Error("Invalid method "+e);c&&h&&("<"===a?h=false:">"===a?c=false:e.match(/element/)||t&&n[0]instanceof t?"element"===o.defaultChainingScope?c=false:h=false:t&&n[0]instanceof t?h=false:c=false);return h?u[e].apply(u,n).then((function(t){return P.indexOf(T,e)>=0?u:t})):o[e].apply(o,n)}))}}));n._enrich=function(e){return o._enrich(e,r)};n.at=function(e){return o._enrich(n.then((function(t){return t[e]})),r)};n.last=function(){return n.then((function(e){return e[e.length-1]}))};n.nth=function(e){return n.at(e-1)};n.first=function(){return n.nth(1)};n.second=function(){return n.nth(2)};n.third=function(){return n.nth(3)};n.printError=function(e){e=e||"";return o._enrich(n.catch((function(t){console.log(e+t);throw t})),r)};n.print=function(e){e=e||"";return o._enrich(n.then((function(t){console.log(e+t)})),r)}}return e};PromiseWebdriver.prototype.chain=PromiseWebdriver.prototype.noop;PromiseElement.prototype.chain=PromiseElement.prototype.noop;PromiseWebdriver.prototype.resolve=function(e){var t=new C(e);this._enrich(t);return t};PromiseElement.prototype.resolve=function(e){var t=new C(e);this._enrich(t);return t};PromiseElement.prototype._enrich=function(e){if(r)return(this||w).browser._enrich(e,this||w)};PromiseWebdriver._wrapAsync=wrap;PromiseWebdriver.prototype._debugPromise=function(){this.on("promise",(function(e,r,o,n){o=P.clone(o);e=e instanceof PromiseWebdriver?"":" [element "+e.value+"]";"function"===typeof P.last(o)&&o.pop();o=" ( "+P(o).map((function(e){return e instanceof t?e.toString():"object"===typeof e?JSON.stringify(e):e})).join(", ")+" )";console.log(" --\x3e "+n+e+" "+r+o)}))};return{PromiseWebdriver:PromiseWebdriver,PromiseElement:PromiseElement}};var S=b;var R="undefined"!==typeof globalThis?globalThis:"undefined"!==typeof self?self:global;var O={};var I=s;var F=Array.prototype.slice,D=e,W=l,k=p,U=a,j=o,K=j.deprecator,H=n,L=r,G=u,x=A;function buildConfigUrl(e){var t=L(e).clone();if(t.host&&t.host.indexOf(":")<0&&t.port){t.hostname=t.host;delete t.host}if(t.username){t.user=t.username;delete t.username}if(t.accessKey){t.pwd=t.accessKey;delete t.accessKey}if(t.https){t.protocol="https:";delete t.https}if(t.path){t.pathname=t.path;delete t.path}if(t.user&&t.pwd){t.auth=t.user+":"+t.pwd;delete t.user;delete t.pwd}L.defaults(t,{protocol:"http:",hostname:"127.0.0.1",port:"4444",pathname:"/wd/hub"});var r=D.parse(D.format(t),true);"/"===r.pathname[r.pathname.length-1]&&(r.pathname=r.pathname.slice(0,r.pathname.length-1));return r}var parseRemoteWdConfig=function(e){var t;t="object"===typeof e[0]?e[0].href&&e[0].format?e[0]:buildConfigUrl(e[0]):"string"===typeof e[0]&&e[0].match(/^https?:\/\//)?D.parse(e[0]):buildConfigUrl({hostname:e[0],port:e[1],user:e[2],pwd:e[3]});/saucelabs\.com/.exec(t.hostname)&&!t.auth&&I.env.SAUCE_USERNAME&&I.env.SAUCE_ACCESS_KEY&&(t.auth=I.env.SAUCE_USERNAME+":"+I.env.SAUCE_ACCESS_KEY);return t};var B,J,Y,$;function remote(){var e=1<=arguments.length?F.call(arguments,0):[];var t={async:k,promise:B,promiseChain:Y};var r=L(t).keys();var o=r.indexOf(L(e).last())>0?e.pop():"async";var n=parseRemoteWdConfig(e);return new t[o](n)}function wrap(){var e=S(k,U,false);B=e.PromiseWebdriver;J=e.PromiseElement;var t=S(k,U,true);Y=t.PromiseWebdriver;$=t.PromiseElement}function addPromiseChainMethod(e,t){var wrappedMethod=function(){var e=1<=arguments.length?F.call(arguments,0):[];var r=new G(t.apply(this||R,e));this._enrich(r);return r};Y.prototype[e]=wrappedMethod}function addElementPromiseChainMethod(e,t){var wrappedMethod=function(){var e=1<=arguments.length?F.call(arguments,0):[];var r=new G(t.apply(this||R,e));this._enrich(r);return r};$.prototype[e]=wrappedMethod}function addPromiseMethod(e,t){var wrappedMethod=function(){var e=1<=arguments.length?F.call(arguments,0):[];return new G(t.apply(this||R,e))};B.prototype[e]=wrappedMethod;addPromiseChainMethod(e,t)}function addElementPromiseMethod(e,t){var wrappedMethod=function(){var e=1<=arguments.length?F.call(arguments,0):[];return new G(t.apply(this||R,e))};J.prototype[e]=wrappedMethod;addElementPromiseChainMethod(e,t)}function addAsyncMethod(e,t){k.prototype[e]=t;B.prototype[e]=B._wrapAsync(t);Y.prototype[e]=Y._wrapAsync(t)}function addElementAsyncMethod(e,t){U.prototype[e]=t;J.prototype[e]=B._wrapAsync(t);$.prototype[e]=Y._wrapAsync(t)}function removeMethod(e){delete k.prototype[e];delete B.prototype[e];delete Y.prototype[e]}function asyncRemote(){var e=1<=arguments.length?F.call(arguments,0):[];var t=parseRemoteWdConfig(e);return new k(t)}function promiseRemote(){var e=1<=arguments.length?F.call(arguments,0):[];var t=parseRemoteWdConfig(e);return new B(t)}function promiseChainRemote(){var e=1<=arguments.length?F.call(arguments,0):[];var t=parseRemoteWdConfig(e);return new Y(t)}wrap();O={remote:remote,asyncRemote:asyncRemote,promiseRemote:promiseRemote,promiseChainRemote:promiseChainRemote,Webdriver:k,webdriver:k,Element:U,PromiseChainWebdriver:Y,PromiseWebdriver:B,TouchAction:x.TouchAction,MultiAction:x.MultiAction,InputDevice:x.InputDevice,W3CActions:x.W3CActions,rewrap:function(){K.warn("rewrap","rewrap has been deprecated, use addAsyncMethod instead.");wrap()},configureHttp:H.configureHttp,getHttpConfig:function(){return L(H.httpConfig).clone()},showHideDeprecation:K.showHideDeprecation.bind(K),addAsyncMethod:addAsyncMethod,addElementAsyncMethod:addElementAsyncMethod,addPromiseMethod:addPromiseMethod,addElementPromiseMethod:addElementPromiseMethod,addPromiseChainMethod:addPromiseChainMethod,addElementPromiseChainMethod:addElementPromiseChainMethod,removeMethod:removeMethod,Asserter:i.Asserter,asserters:i,SPECIAL_KEYS:W,Q:G,findCallback:j.findCallback,varargs:j.varargs,transferPromiseness:j.transferPromiseness,utils:j,setBaseClasses:function(e,t){k=e;U=t;wrap()}};var q=O;const Q=O.webdriver,Z=O.TouchAction;const z=O.remote,V=O.asyncRemote,X=O.promiseRemote,ee=O.promiseChainRemote,te=O.Webdriver,re=O.Element,oe=O.PromiseChainWebdriver,ne=O.PromiseWebdriver;export default q;export{re as Element,oe as PromiseChainWebdriver,ne as PromiseWebdriver,Z as TouchAction,te as Webdriver,V as asyncRemote,ee as promiseChainRemote,X as promiseRemote,z as remote,Q as webdriver};

